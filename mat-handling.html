<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Material Handling Checklist</title>
<style>
  :root{
    --brand:#6a1b9a; --row:#f7f9fc; --header:#0ea5e9; --border:#d1d5db;
    --ok:#16a34a; --bad:#ef4444; --muted:#6b7280;
  }
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;margin:0;color:#111827;background:#fff}
  .page{max-width:1050px;margin:16px auto;padding:16px}
  .title{color:var(--brand);text-align:center;font-weight:800;font-size:clamp(18px,4vw,28px);margin:0 0 6px}

  /* LOGO */
  .logo-wrap{
    display:flex;justify-content:center;align-items:center;margin:6px 0 12px;
    gap:16px; flex-wrap:wrap;
  }
  .logo-wrap img{width:min(40vw,260px);height:auto;max-height:120px}
  .logo-caption{font-size:12px;color:#374151;text-align:center;margin-top:4px}
  @media (max-width:480px){
    .logo-wrap img{width:min(44vw,220px);max-height:90px}
  }

  /* Language buttons */
  .langbar{
    display:flex;justify-content:flex-end;gap:10px;align-items:center;
    margin:12px 0 8px; /* diturunkan satu row dari sebelumnya (-4px => 12px) */
    flex-wrap:wrap;
  }
  .langbar .hint{font-size:12px;color:#374151;margin-right:4px}
  .lang-btn{
    display:inline-flex;align-items:center;gap:8px;
    border:1px solid var(--border);border-radius:999px;background:#fff;
    padding:8px 12px; cursor:pointer; user-select:none;
    box-shadow:0 1px 2px rgba(0,0,0,.04);
    min-height:44px;
  }
  .lang-btn[aria-pressed="true"]{
    outline:2px solid #0ea5e9; outline-offset:2px;
    box-shadow:0 0 0 2px rgba(14,165,233,.15) inset;
  }
  .lang-btn img{width:24px;height:auto;display:block}
  .lang-btn .lbl{font-size:13px;color:#111}
  @media (max-width:480px){
    .lang-btn{padding:8px 10px}
    .lang-btn .lbl{display:none}
    .lang-btn img{width:28px}
  }

  .meta{display:grid;gap:8px 16px;grid-template-columns:repeat(6,1fr);font-size:13px;margin-bottom:8px}
  .meta .label{color:#374151}
  .meta input{width:100%;padding:6px 8px;border:1px solid var(--border);border-radius:6px}

  /* table */
  .chk-table{width:100%;border-collapse:separate;border-spacing:0;overflow:hidden;border:1px solid var(--border);border-radius:10px;margin-top:6px}
  .chk-table thead th{background:var(--header);color:#fff;padding:10px 8px;font-weight:700;font-size:13px;text-align:center;border-right:1px solid var(--header)}
  .chk-table thead th:last-child{border-right:none}
  .section-head{background:#e2f3fb;color:#0b4a6f;font-weight:700;padding:8px;font-size:13px;border-top:1px solid var(--border);border-bottom:1px solid var(--border)}
  .col-no{width:70px;text-align:center;font-weight:800;color:#0b4a6f}
  .chk-table td{padding:8px;border-top:1px solid var(--border)}
  .row-alt{background:var(--row)}
  .ques{font-size:13px;line-height:1.35}
  .yn{display:flex;gap:10px;align-items:center}
  .yn label{display:flex;gap:6px;align-items:center;font-size:13px}
  .yn input{width:18px;height:18px}

  /* remarks + counter */
  .remarks{width:100%;min-height:40px;border:1px solid var(--border);border-radius:8px;padding:6px 8px;font-size:12px;resize:vertical}
  .subrow td{border-top:none;padding-top:4px;padding-bottom:8px}
  .remarks-cell{padding:6px 8px 6px}
  .remarks-wrap{display:flex;flex-direction:column;gap:4px}
  .counter{font-size:11px;color:#6b7280}
  .counter.limit{color:var(--bad);font-weight:700}

  /* scores */
  .scores{display:grid;gap:10px;grid-template-columns:repeat(5,1fr);margin:12px 0 6px}
  .score-card{border:1px solid var(--border);border-radius:10px;background:#fafafa;padding:10px}
  .score-card h4{margin:0 0 8px;font-size:13px;color:#0b4a6f}
  .score-val{font-weight:800;font-size:18px}
  .badge{border-radius:999px;padding:3px 8px;font-size:11px;margin-left:8px;color:#fff;background:#111827}
  .good{background:var(--ok)!important} .bad{background:var(--bad)!important}

  /* photos */
  .photos-title{
    margin:12px 0 4px; text-align:center; font-weight:800;
    font-size:clamp(16px,3.5vw,20px); color:#0b4a6f;
  }
  .photos{display:grid;gap:12px;grid-template-columns:repeat(2,1fr);margin-top:16px}
  .photo-card{background:#4f81bd;border-radius:14px;padding:10px;color:#fff;min-height:210px;display:flex;flex-direction:column;gap:8px;break-inside:avoid}
  .photo-stage{flex:1;border:2px dashed rgba(255,255,255,.7);border-radius:12px;display:grid;place-items:center;overflow:hidden;background:rgba(255,255,255,.06)}
  .photo-stage img{max-width:100%;max-height:100%;object-fit:contain;display:block}
  .photo-actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .photo-actions input[type=file]{color:#fff;font-size:12px}
  .photo-desc{flex:1;min-width:120px;border:none;border-radius:8px;padding:6px 8px;font-size:12px}
  .photo-desc-print{display:none;margin-top:6px;font-size:12px;line-height:1.3;background:rgba(255,255,255,.12);padding:4px 6px;border-radius:6px}

  /* footer */
  .footer{margin-top:24px;text-align:center;font-size:12px;color:#374151}
  .footer .line{height:1px;background:var(--border);margin:10px 0}
  .footer b{color:#111827}
  /* global line */
  .line{height:1px;background:var(--border);margin:10px 0}

  /* responsive */
  @media (max-width:800px){ .meta{grid-template-columns:repeat(2,1fr)} }
  @media (max-width:640px){ .photos{grid-template-columns:1fr} .col-no{width:64px} }

  /* print */
  @page{size:A4 portrait;margin:12mm}
  @media print{
    .toolbar{display:none!important}
    .page{margin:0;padding:0}
    .score-val{font-size:16px}
    .chk-table td{padding:6px}
    .logo-caption{display:none}
    textarea.remarks{
      border:none !important; outline:none !important; resize:none !important;
      overflow:visible !important; white-space:pre-wrap !important;
      font-size:12px !important; background:transparent !important;
      height:auto !important; min-height:unset !important;
      -webkit-appearance:none; appearance:none;
    }
    .counter{display:none}

    /* Photos page dedicated */
    .photos{
      page-break-before: always;
      page-break-after: always;
      grid-template-columns: 1fr 1fr;
      gap: 6mm;
      margin-top: 0;
    }
    .photo-card{
      background:#fff; color:#111;
      border:1px solid #ddd; padding:5mm; border-radius:6px;
      min-height:120mm;
      break-inside: avoid;
      page-break-inside: avoid;
    }
    .photo-stage{ border:1px solid #ccc; background:#fff; border-radius:4px; }
    .photo-actions{display:none}
    .photo-desc-print{ display:block; font-size:11px; color:#111; background:transparent; padding:0; margin-top:3mm }

    .footer{font-size:11px}
  }
</style>
</head>
<body>
<div class="page">
  <div class="title">MATERIAL HANDLING CHECKLIST</div>

  <!-- LOGO: hanya Turner & Townsend -->
  <div class="logo-wrap" aria-label="Logo Turner & Townsend">
    <img src="https://mokhamadabrar.github.io/site_inspect/tnt_logo.svg" alt="Turner & Townsend" />
  </div>
  <div class="logo-caption"></div>

  <!-- Language Buttons -->
  <div class="langbar" role="group" aria-label="Auto translate">
    <span class="hint">Auto translate:</span>
    <button id="btnID" type="button" class="lang-btn" aria-pressed="false" aria-label="Indonesia">
      <img src="https://mokhamadabrar.github.io/site_inspect/ID.png" alt="ID"/>
      <span class="lbl">Indonesia</span>
    </button>
    <button id="btnEN" type="button" class="lang-btn" aria-pressed="false" aria-label="English">
      <img src="https://mokhamadabrar.github.io/site_inspect/EN.png" alt="EN"/>
      <span class="lbl">English</span>
    </button>
  </div>

  <!-- Meta (tambah Kontraktor) -->
  <div class="meta">
    <div class="label" data-i18n="label_site">Site Assesssor</div><input id="inp-assessor" placeholder="Nama Site Assesssor"/>
    <div class="label" data-i18n="label_project">Project</div><input id="inp-project" value="JKT09" placeholder="Kode/Nama"/>
    <div class="label" data-i18n="label_date">Date</div><input id="inp-date" type="date"/>
    <div class="label" data-i18n="label_location">Location</div><input id="inp-location" placeholder="Lokasi"/>
    <div class="label" data-i18n="label_contractor">Kontraktor</div><input id="inp-contractor" placeholder="Nama Kontraktor"/>
  </div>

  <table class="chk-table" id="chkTable">
    <thead>
      <tr>
        <th class="col-no" data-i18n="th_no">No.</th>
        <th data-i18n="th_question">Pertanyaan</th>
        <th data-i18n="th_yes">YES</th>
        <th data-i18n="th_no2">NO</th>
        <th data-i18n="th_na">N/A</th>
      </tr>
    </thead>

    <!-- ===== SECTION A ===== -->
    <tbody data-section="A">
      <tr><td class="section-head" colspan="5">A. METHOD OF WORK PLAN</td></tr>

      <tr class="row-alt">
        <td class="col-no">A1</td>
        <td colspan="4"><div class="ques">Apakah penempatan material telah sesuai dengan lokasi pada MSRA, dan telah sesuai dengan persyaratan tempat penyimpanan?</div></td>
      </tr>
      <tr class="subrow row-alt">
        <td></td>
        <td>
          <div class="yn">
            <label><input type="radio" name="A1" value="yes"> Ya</label>
            <label><input type="radio" name="A1" value="no"> Tidak</label>
            <label><input type="radio" name="A1" value="na"> N/A</label>
          </div>
        </td>
        <td colspan="3" class="remarks-cell">
          <div class="remarks-wrap">
            <textarea class="remarks" maxlength="70" placeholder="Remarks (maks 70 karakter)…"></textarea>
            <div class="counter">0/70</div>
          </div>
        </td>
      </tr>

      <tr>
        <td class="col-no">A2</td>
        <td colspan="4"><div class="ques">Apakah berat/dimensi material, metode memindahkan telah didiskusikan? (check MSRA dan bagaimana rute Kendaraan dan pertimbangkan berat beban material)</div></td>
      </tr>
      <tr class="subrow">
        <td></td>
        <td><div class="yn">
          <label><input type="radio" name="A2" value="yes"> Ya</label>
          <label><input type="radio" name="A2" value="no"> Tidak</label>
          <label><input type="radio" name="A2" value="na"> N/A</label>
        </div></td>
        <td colspan="3" class="remarks-cell">
          <div class="remarks-wrap">
            <textarea class="remarks" maxlength="70"></textarea>
            <div class="counter">0/70</div>
          </div>
        </td>
      </tr>

      <tr class="row-alt">
        <td class="col-no">A3</td>
        <td colspan="4"><div class="ques">Apakah penempatan material tidak menghalangi pejalan kaki, tersedia akses untuk pengambilan material, dan telah tersedia barricade?</div></td>
      </tr>
      <tr class="subrow row-alt">
        <td></td>
        <td><div class="yn">
          <label><input type="radio" name="A3" value="yes"> Ya</label>
          <label><input type="radio" name="A3" value="no"> Tidak</label>
          <label><input type="radio" name="A3" value="na"> N/A</label>
        </div></td>
        <td colspan="3" class="remarks-cell">
          <div class="remarks-wrap">
            <textarea class="remarks" maxlength="70"></textarea>
            <div class="counter">0/70</div>
          </div>
        </td>
      </tr>

      <tr>
        <td class="col-no">A4</td>
        <td colspan="4"><div class="ques">Apakah anda mengetahui batas max angkat manual adalah 18.14 kg. Dan jika material panjang atau &gt;3 m harus diangkat lebih dari satu orang.</div></td>
      </tr>
      <tr class="subrow">
        <td></td>
        <td><div class="yn">
          <label><input type="radio" name="A4" value="yes"> Ya</label>
          <label><input type="radio" name="A4" value="no"> Tidak</label>
          <label><input type="radio" name="A4" value="na"> N/A</label>
        </div></td>
        <td colspan="3" class="remarks-cell">
          <div class="remarks-wrap">
            <textarea class="remarks" maxlength="70"></textarea>
            <div class="counter">0/70</div>
          </div>
        </td>
      </tr>
    </tbody>

    <!-- ===== SECTION B ===== -->
    <tbody data-section="B">
      <tr><td class="section-head" colspan="5">B. PEOPLE / COMPETENCE / QUALIFICATION</td></tr>

      <tr class="row-alt"><td class="col-no">B5</td><td colspan="4" class="ques">Kepada siapa anda melapor jika anda membutuhkan alat untuk memindahkan material anda?</td></tr>
      <tr class="subrow row-alt"><td></td><td><div class="yn">
        <label><input type="radio" name="B5" value="yes"> Ya</label>
        <label><input type="radio" name="B5" value="no"> Tidak</label>
        <label><input type="radio" name="B5" value="na"> N/A</label>
      </div></td><td colspan="3" class="remarks-cell">
        <div class="remarks-wrap">
          <textarea class="remarks" maxlength="70"></textarea>
          <div class="counter">0/70</div>
        </div>
      </td></tr>

      <tr><td class="col-no">B6</td><td colspan="4" class="ques">Apakah anda telah memeriksa bahwa alat pemindah atau pengangkat tersebut telah dilakukan checklist sebelum digunakan?</td></tr>
      <tr class="subrow"><td></td><td><div class="yn">
        <label><input type="radio" name="B6" value="yes"> Ya</label>
        <label><input type="radio" name="B6" value="no"> Tidak</label>
        <label><input type="radio" name="B6" value="na"> N/A</label>
      </div></td><td colspan="3" class="remarks-cell">
        <div class="remarks-wrap">
          <textarea class="remarks" maxlength="70"></textarea>
          <div class="counter">0/70</div>
        </div>
      </td></tr>

      <tr class="row-alt"><td class="col-no">B7</td><td colspan="4" class="ques">Apakah Operator alat pemindah/angkat telah memiliki lisensi (SIO) dan masih berlaku?</td></tr>
      <tr class="subrow row-alt"><td></td><td><div class="yn">
        <label><input type="radio" name="B7" value="yes"> Ya</label>
        <label><input type="radio" name="B7" value="no"> Tidak</label>
        <label><input type="radio" name="B7" value="na"> N/A</label>
      </div></td><td colspan="3" class="remarks-cell">
        <div class="remarks-wrap">
          <textarea class="remarks" maxlength="70"></textarea>
          <div class="counter">0/70</div>
        </div>
      </td></tr>
    </tbody>

    <!-- ===== SECTION C ===== -->
    <tbody data-section="C">
      <tr><td class="section-head" colspan="5">C. TOOLS / Equipments</td></tr>

      <tr class="row-alt"><td class="col-no">C8</td><td colspan="4" class="ques">Apakah sertifikasi alat angkat (SILO) tersedia dan masih berlaku?</td></tr>
      <tr class="subrow row-alt"><td></td><td><div class="yn">
        <label><input type="radio" name="C8" value="yes"> Ya</label>
        <label><input type="radio" name="C8" value="no"> Tidak</label>
        <label><input type="radio" name="C8" value="na"> N/A</label>
      </div></td><td colspan="3" class="remarks-cell">
        <div class="remarks-wrap">
          <textarea class="remarks" maxlength="70"></textarea>
          <div class="counter">0/70</div>
        </div>
      </td></tr>

      <tr><td class="col-no">C9</td><td colspan="4" class="ques">Apakah Alat pemindah (angkat) yang digunakan telah diperiksa sebelum didatangkan / dipakai.</td></tr>
      <tr class="subrow"><td></td><td><div class="yn">
        <label><input type="radio" name="C9" value="yes"> Ya</label>
        <label><input type="radio" name="C9" value="no"> Tidak</label>
        <label><input type="radio" name="C9" value="na"> N/A</label>
      </div></td><td colspan="3" class="remarks-cell">
        <div class="remarks-wrap">
          <textarea class="remarks" maxlength="70"></textarea>
          <div class="counter">0/70</div>
        </div>
      </td></tr>

      <tr class="row-alt"><td class="col-no">C10</td><td colspan="4" class="ques">Apakah Alat bantu lainnya telah diinspeksi &amp; dinyatakan layak.</td></tr>
      <tr class="subrow row-alt"><td></td><td><div class="yn">
        <label><input type="radio" name="C10" value="yes"> Ya</label>
        <label><input type="radio" name="C10" value="no"> Tidak</label>
        <label><input type="radio" name="C10" value="na"> N/A</label>
      </div></td><td colspan="3" class="remarks-cell">
        <div class="remarks-wrap">
          <textarea class="remarks" maxlength="70"></textarea>
          <div class="counter">0/70</div>
        </div>
      </td></tr>

      <tr><td class="col-no">C11</td><td colspan="4" class="ques">Apakah PPE telah sesuai dengan aturan MSDS?</td></tr>
      <tr class="subrow"><td></td><td><div class="yn">
        <label><input type="radio" name="C11" value="yes"> Ya</label>
        <label><input type="radio" name="C11" value="no"> Tidak</label>
        <label><input type="radio" name="C11" value="na"> N/A</label>
      </div></td><td colspan="3" class="remarks-cell">
        <div class="remarks-wrap">
          <textarea class="remarks" maxlength="70"></textarea>
          <div class="counter">0/70</div>
        </div>
      </td></tr>
    </tbody>

    <!-- ===== SECTION D ===== -->
    <tbody data-section="D">
      <tr><td class="section-head" colspan="5">D. ENVIRONMENT MANAGEMENT / CLEAN WORKPLACE</td></tr>

      <tr class="row-alt"><td class="col-no">D12</td><td colspan="4" class="ques">Apakah anda telah memiliki tempat sampah untuk material sisa yang akan dibuang?</td></tr>
      <tr class="subrow row-alt"><td></td><td><div class="yn">
        <label><input type="radio" name="D12" value="yes"> Ya</label>
        <label><input type="radio" name="D12" value="no"> Tidak</label>
        <label><input type="radio" name="D12" value="na"> N/A</label>
      </div></td><td colspan="3" class="remarks-cell">
        <div class="remarks-wrap">
          <textarea class="remarks" maxlength="70"></textarea>
          <div class="counter">0/70</div>
        </div>
      </td></tr>

      <tr><td class="col-no">D13</td><td colspan="4" class="ques">Apakah anda mengetahui secara harian dimana lokasi koleksi point pembuangan sampah anda</td></tr>
      <tr class="subrow"><td></td><td><div class="yn">
        <label><input type="radio" name="D13" value="yes"> Ya</label>
        <label><input type="radio" name="D13" value="no"> Tidak</label>
        <label><input type="radio" name="D13" value="na"> N/A</label>
      </div></td><td colspan="3" class="remarks-cell">
        <div class="remarks-wrap">
          <textarea class="remarks" maxlength="70"></textarea>
          <div class="counter">0/70</div>
        </div>
      </td></tr>

      <tr class="row-alt"><td class="col-no">D14</td><td colspan="4" class="ques">Apakah anda telah melakukan kebersihan sebelum bekerja dan sesudah bekerja dan menata kembali peralatan</td></tr>
      <tr class="subrow row-alt"><td></td><td><div class="yn">
        <label><input type="radio" name="D14" value="yes"> Ya</label>
        <label><input type="radio" name="D14" value="no"> Tidak</label>
        <label><input type="radio" name="D14" value="na"> N/A</label>
      </div></td><td colspan="3" class="remarks-cell">
        <div class="remarks-wrap">
          <textarea class="remarks" maxlength="70"></textarea>
          <div class="counter">0/70</div>
        </div>
      </td></tr>

      <tr><td class="col-no">D15</td><td colspan="4" class="ques">Jika material anda didalam building apakah anda menyediakan Floor Protection dan menghindari terjadinya Debu</td></tr>
      <tr class="subrow"><td></td><td><div class="yn">
        <label><input type="radio" name="D15" value="yes"> Ya</label>
        <label><input type="radio" name="D15" value="no"> Tidak</label>
        <label><input type="radio" name="D15" value="na"> N/A</label>
      </div></td><td colspan="3" class="remarks-cell">
        <div class="remarks-wrap">
          <textarea class="remarks" maxlength="70"></textarea>
          <div class="counter">0/70</div>
        </div>
      </td></tr>
    </tbody>
  </table>

  <!-- Scores -->
  <div class="scores">
    <div class="score-card"><h4>Score A</h4><div class="score-val" id="scoreA">0%</div></div>
    <div class="score-card"><h4>Score B</h4><div class="score-val" id="scoreB">0%</div></div>
    <div class="score-card"><h4>Score C</h4><div class="score-val" id="scoreC">0%</div></div>
    <div class="score-card"><h4>Score D</h4><div class="score-val" id="scoreD">0%</div></div>
    <div class="score-card"><h4>Total Score <span id="badge" class="badge">0/100</span></h4><div class="score-val" id="totalScore">0%</div></div>
  </div>

  <!-- Footer (diletakkan sebelum halaman Foto saat print) -->
  <div class="footer" role="contentinfo">
    <div class="line"></div>
    <div>Created by</div>
    <div><b>Mokhamad Abrar</b> (T&amp;T Safety Advisor)</div>
    <div>Sustainable Development by <b>Abrar (T&amp;T)</b> @ Aug 2025</div>
  </div>

  <!-- Garis tambahan di bawah footer -->
  <div class="line"></div>

  <!-- Judul Photos -->
  <div class="photos-title">Photos Assessment Material</div>

  <!-- Photos (akan menjadi halaman tersendiri saat print) -->
  <div class="photos" id="photos">
    <div class="photo-card" data-slot="1">
      <div class="photo-stage"><span>Add Photo</span></div>
      <div class="photo-actions">
        <input type="file" accept="image/*" />
        <input type="text" class="photo-desc" maxlength="58" placeholder="Deskripsi foto (maks 58)…" />
      </div>
      <div class="photo-desc-print"></div>
    </div>
    <div class="photo-card" data-slot="2">
      <div class="photo-stage"><span>Add Photo</span></div>
      <div class="photo-actions">
        <input type="file" accept="image/*" />
        <input type="text" class="photo-desc" maxlength="58" placeholder="Deskripsi foto (maks 58)…" />
      </div>
      <div class="photo-desc-print"></div>
    </div>
    <div class="photo-card" data-slot="3">
      <div class="photo-stage"><span>Add Photo</span></div>
      <div class="photo-actions">
        <input type="file" accept="image/*" />
        <input type="text" class="photo-desc" maxlength="58" placeholder="Deskripsi foto (maks 58)…" />
      </div>
      <div class="photo-desc-print"></div>
    </div>
    <div class="photo-card" data-slot="4">
      <div class="photo-stage"><span>Add Photo</span></div>
      <div class="photo-actions">
        <input type="file" accept="image/*" />
        <input type="text" class="photo-desc" maxlength="58" placeholder="Deskripsi foto (maks 58)…" />
      </div>
      <div class="photo-desc-print"></div>
    </div>
  </div>

  <div class="toolbar" style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px;flex-wrap:wrap">
    <button class="btn" id="printBtn" style="border:none;border-radius:10px;padding:10px 14px;font-weight:700;background:#111827;color:#fff">Print PDF (A4)</button>
    <button class="btn" id="resetBtn" style="border:none;border-radius:10px;padding:10px 14px;font-weight:700;background:#0ea5e9;color:#fff">Reset</button>
  </div>
</div>

<script>
  /* ==== LANGUAGE STATE ==== */
  let currentLang = (localStorage.getItem('mhc_lang') === 'en') ? 'en' : 'id';
  const getLang = () => currentLang;

  /* ==== SCORING ==== */
  function scoreSection(sec){
    const names = new Set();
    sec.querySelectorAll('input[type=radio]').forEach(r=>names.add(r.name));
    let yes=0, denom=0;
    names.forEach(n=>{
      const chosen = sec.querySelector(`input[name="${n}"]:checked`);
      if(!chosen || chosen.value==='na') return;
      denom++; if(chosen.value==='yes') yes++;
    });
    return denom? Math.round(100*yes/denom):0;
  }
  function refreshScores(){
    const A = document.querySelector('tbody[data-section="A"]');
    const B = document.querySelector('tbody[data-section="B"]');
    const C = document.querySelector('tbody[data-section="C"]');
    const D = document.querySelector('tbody[data-section="D"]');
    const sA = scoreSection(A), sB = scoreSection(B), sC = scoreSection(C), sD = scoreSection(D);

    let yes=0, denom=0;
    [A,B,C,D].forEach(sec=>{
      const names = new Set();
      sec.querySelectorAll('input[type=radio]').forEach(r=>names.add(r.name));
      names.forEach(n=>{
        const chosen = sec.querySelector(`input[name="${n}"]:checked`);
        if(!chosen || chosen.value==='na') return;
        denom++; if(chosen.value==='yes') yes++;
      });
    });
    const total = denom? Math.round(100*yes/denom):0;

    document.getElementById('scoreA').textContent = sA + '%';
    document.getElementById('scoreB').textContent = sB + '%';
    document.getElementById('scoreC').textContent = sC + '%';
    document.getElementById('scoreD').textContent = sD + '%';
    document.getElementById('totalScore').textContent = total + '%';
    const badge = document.getElementById('badge');
    badge.textContent = `${total}/100`;
    badge.classList.remove('good','bad');
    badge.classList.add(total>=80 ? 'good' : 'bad');
  }
  document.querySelectorAll('#chkTable input[type=radio]').forEach(r=>r.addEventListener('change', refreshScores));
  refreshScores();

  /* ==== LIMIT HELPERS ==== */
  function enforceMaxWithAlert(el, MAX, fieldName){
    if(el.value.length > MAX){
      el.value = el.value.slice(0, MAX);
      const lang = getLang();
      const msg = lang==='en'
        ? `Maximum ${MAX} characters for ${fieldName}. Text has been truncated to meet the requirement.`
        : `Maksimal ${MAX} karakter untuk ${fieldName}. Teks telah dipotong agar sesuai ketentuan.`;
      alert(msg);
      return true;
    }
    return false;
  }

  /* ==== REMARKS (70) ==== */
  const MAX_REMARKS = 70;
  function updateCounter(area){
    const wrap = area.closest('.remarks-wrap');
    const counter = wrap.querySelector('.counter');
    const len = area.value.length;
    counter.textContent = `${len}/${MAX_REMARKS}`;
    counter.classList.toggle('limit', len >= MAX_REMARKS);
  }
  document.querySelectorAll('textarea.remarks').forEach(area=>{
    area.setAttribute('maxlength', String(MAX_REMARKS));
    updateCounter(area);
    area.addEventListener('input', e=>{
      enforceMaxWithAlert(e.target, MAX_REMARKS, getLang()==='en'?'Remarks':'Remarks');
      updateCounter(e.target);
    });
    area.addEventListener('paste', e=>{
      setTimeout(()=>{
        enforceMaxWithAlert(e.target, MAX_REMARKS, getLang()==='en'?'Remarks':'Remarks');
        updateCounter(e.target);
      },0);
    });
  });

  /* ==== PHOTOS (58) ==== */
  const MAX_DESC = 58;
  document.querySelectorAll('.photo-card input[type=file]').forEach(inp=>{
    inp.addEventListener('change', e=>{
      const file = e.target.files[0]; if(!file) return;
      const stage = e.target.closest('.photo-card').querySelector('.photo-stage');
      const img = document.createElement('img');
      const rd = new FileReader();
      rd.onload = ev=>{ stage.innerHTML=''; img.src = ev.target.result; stage.appendChild(img); };
      rd.readAsDataURL(file);
    });
  });
  document.querySelectorAll('.photo-card .photo-desc').forEach(desc=>{
    const printBox = desc.closest('.photo-card').querySelector('.photo-desc-print');
    const sync = ()=>{
      enforceMaxWithAlert(desc, MAX_DESC, getLang()==='en'?'Photo Description':'Deskripsi Foto');
      printBox.textContent = desc.value ? desc.value : '';
    };
    desc.setAttribute('maxlength', String(MAX_DESC));
    sync();
    desc.addEventListener('input', sync);
    desc.addEventListener('paste', ()=>setTimeout(sync,0));
  });

  /* ==== i18n ==== */
  function getQuestionMap(){
    const map = {};
    document.querySelectorAll('.chk-table tbody tr').forEach(tr=>{
      const no = tr.querySelector('.col-no');
      const q = tr.querySelector('.ques');
      if(no && q){ map[no.textContent.trim()] = q; }
    });
    return map;
  }
  const qMap = getQuestionMap();

  const baselineID = {};
  Object.keys(qMap).forEach(k => baselineID[k] = qMap[k].textContent.trim());

  const i18n = {
    id: {
      labels: {
        label_site: "Site Assesssor",
        label_project: "Project",
        label_date: "Date",
        label_location: "Location",
        label_contractor: "Kontraktor",
        th_no: "No.",
        th_question: "Pertanyaan",
        th_yes: "YES",
        th_no2: "NO",
        th_na: "N/A",
        ph_assessor: "Nama Site Assesssor",
        ph_project: "Kode/Nama",
        ph_location: "Lokasi",
        ph_contractor: "Nama Kontraktor",
        ph_remarks: "Remarks (maks 70 karakter)…",
        ph_photo: "Deskripsi foto (maks 58)…",
        radio_yes: "Ya",
        radio_no: "Tidak",
        radio_na: "N/A"
      },
      questions: baselineID
    },
    en: {
      labels: {
        label_site: "Site Assessor",
        label_project: "Project",
        label_date: "Date",
        label_location: "Location",
        label_contractor: "Contractor",
        th_no: "No.",
        th_question: "Question",
        th_yes: "YES",
        th_no2: "NO",
        th_na: "N/A",
        ph_assessor: "Site assessor name",
        ph_project: "Code/Name",
        ph_location: "Location",
        ph_contractor: "Contractor name",
        ph_remarks: "Remarks (max 70 characters)…",
        ph_photo: "Photo description (max 58)…",
        radio_yes: "Yes",
        radio_no: "No",
        radio_na: "N/A"
      },
      questions: {
        A1: "Is the placement of materials compliant with the MSRA location and storage requirements?",
        A2: "Have the material weight/dimensions and movement method been discussed? (check the MSRA; plan vehicle route and consider load weight)",
        A3: "Does the material placement not obstruct pedestrians, provide access for picking, and are barricades provided?",
        A4: "Do you know the manual lifting limit is 18.14 kg per person, and loads longer than 3 m must be lifted by more than one person?",
        B5: "Whom do you report to if you need equipment to move your materials?",
        B6: "Have you checked that the handling/lifting equipment has been pre-use checklisted?",
        B7: "Do the handling/lifting equipment operators hold a valid license (SIO)?",
        C8: "Is the lifting equipment certification (SILO) available and valid?",
        C9: "Has the handling (lifting) equipment been inspected before being mobilized/used?",
        C10:"Have other auxiliary tools been inspected and declared fit for use?",
        C11:"Is the PPE in accordance with MSDS requirements?",
        D12:"Do you have waste bins for leftover materials to be disposed of?",
        D13:"Do you know the daily location of your waste collection points?",
        D14:"Do you clean before and after work and tidy up the tools?",
        D15:"If your materials are inside the building, do you provide floor protection and prevent dust generation?"
      }
    }
  };

  function setPlaceholders(lang){
    document.getElementById('inp-assessor').placeholder = i18n[lang].labels.ph_assessor;
    document.getElementById('inp-project').placeholder  = i18n[lang].labels.ph_project;
    document.getElementById('inp-location').placeholder = i18n[lang].labels.ph_location;
    document.getElementById('inp-contractor').placeholder = i18n[lang].labels.ph_contractor;
    document.querySelectorAll('textarea.remarks').forEach(t=> t.placeholder = i18n[lang].labels.ph_remarks);
    document.querySelectorAll('.photo-desc').forEach(p=> p.placeholder = i18n[lang].labels.ph_photo);
  }
  function setLabels(lang){
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const key = el.getAttribute('data-i18n');
      const txt = i18n[lang].labels[key];
      if(txt) el.textContent = txt;
    });
  }
  function setRadioLabels(lang){
    const yesTxt = i18n[lang].labels.radio_yes;
    const noTxt  = i18n[lang].labels.radio_no;
    const naTxt  = i18n[lang].labels.radio_na;
    document.querySelectorAll('.yn label').forEach(lab=>{
      const inp = lab.querySelector('input');
      if(!inp) return;
      let txt = naTxt;
      if(inp.value==='yes') txt = yesTxt;
      else if(inp.value==='no') txt = noTxt;
      let textNode = Array.from(lab.childNodes).find(n=> n.nodeType===Node.TEXT_NODE);
      if(textNode){ textNode.nodeValue = ' ' + txt; }
      else{ lab.appendChild(document.createTextNode(' ' + txt)); }
    });
  }
  function setQuestions(lang){
    const dict = i18n[lang].questions;
    Object.keys(qMap).forEach(key=>{
      const el = qMap[key];
      el.textContent = dict[key] || baselineID[key];
    });
  }
  function applyLanguage(lang){
    currentLang = (lang==='en') ? 'en' : 'id';
    setLabels(currentLang);
    setPlaceholders(currentLang);
    setQuestions(currentLang);
    setRadioLabels(currentLang);
    localStorage.setItem('mhc_lang', currentLang);
    document.getElementById('btnID').setAttribute('aria-pressed', currentLang==='id' ? 'true' : 'false');
    document.getElementById('btnEN').setAttribute('aria-pressed', currentLang==='en' ? 'true' : 'false');
  }

  // INIT: default Indonesia
  applyLanguage(getLang());

  // Buttons
  document.getElementById('btnID').addEventListener('click', ()=>applyLanguage('id'));
  document.getElementById('btnEN').addEventListener('click', ()=>applyLanguage('en'));

  /* ==== PRINT & RESET ==== */
  document.getElementById('printBtn').addEventListener('click', ()=>window.print());
  document.getElementById('resetBtn').addEventListener('click', ()=>{
    document.querySelectorAll('#chkTable input[type=radio]').forEach(r=>r.checked=false);
    document.querySelectorAll('.remarks').forEach(t=>{ t.value=''; updateCounter(t); });
    document.querySelectorAll('.photo-card').forEach(card=>{
      card.querySelector('.photo-stage').innerHTML='<span>Add Photo</span>';
      const f = card.querySelector('input[type=file]'); if(f) f.value='';
      const d = card.querySelector('.photo-desc'); if(d){ d.value=''; }
      const pb = card.querySelector('.photo-desc-print'); if(pb){ pb.textContent=''; }
    });
    refreshScores(); window.scrollTo({top:0,behavior:'smooth'});
  });
</script>
</body>
</html>
